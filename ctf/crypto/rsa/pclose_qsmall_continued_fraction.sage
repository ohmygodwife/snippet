#signin, huxiangbei-2021, https://blog.csdn.net/u010883831/article/details/121506128

from Crypto.Util.number import *

def pclose_qsmall_continued_fraction(n1, n2):
    frac = continued_fraction(n1/n2)
    for i in range(2, len(frac)):
        q1 = frac.numerator(i)
        q2 = frac.denominator(i)
        if n1 % q1 == 0 and n2 % q2 == 0:
          return (q1, q2)
    print "fail to find q"
    exit()
  
(n1, n2) = (1150398070565459492080597718626032792435556703413923483458704675295997646493249759818468321328556510074044954676615760446708253531839417036997811506222349194302791943489195718713797322878586379546657275419261647635859989280700191441312691274285176619391539387875252135478424580680264554294179123254566796890998243909286508189826458854346825493157697201495100628216832191035903848391447704849808577310612723700318670466035077202673373956324725108350230357879374234418393233, 1242678737076048096780023147702514112272319497423818488193557934695583793070332178723043194823444815153743889740338870676093799728875725651036060313223096288606947708155579060628807516053981975820338028456770109640111153719903207363617099371353910243497871090334898522942934052035102902892149792570965804205461900841595290667647854346905445201396273291648968142608158533514391348407631818144116768794595226974831093526512117505486679153727123796834305088741279455621586989)
c1, c2 = (361624030197288323178211941746074961985876772079713896964822566468795093475887773853629454653096485450671233584616088768705417987527877166166213574572987732852155320225332020636386698169212072312758052524652761304795529199864805108000796457423822443871436659548626629448170698048984709740274043050729249408577243328282313593461300703078854044587993248807613713896590402657788194264718603549894361488507629356532718775278399264279359256975688280723740017979438505001819438, 33322989148902718763644384246610630825314206644879155585369541624158380990667828419255828083639294898100922608833810585530801931417726134558845725168047585271855248605561256531342703212030641555260907310067120102069499927711242804407691706542428236208695153618955781372741765233319988193384708525251620506966304554054884590718068210659709406626033891748214407992041364462525367373648910810036622684929049996166651416565651803952838857960054689875755131784246099270581394)
e = 0x10001

(q1, q2) = pclose_qsmall_continued_fraction(n1, n2)
print(q1, q2)

def decrypt(n, q, c):
  p = n/q
  phi = p**3 * (p-1)*(q-1)
  d = e.inverse_mod(phi)
  m = power_mod(c, d, n)
  print long_to_bytes(m)

decrypt(n1, q1, c1)
decrypt(n2, q2, c2)